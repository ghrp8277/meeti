import { DataSource } from 'typeorm';
import { Tos } from '../../entities/tos.entity';

export class TosSeed {
  public async run(dataSource: DataSource): Promise<void> {
    const tosRepository = dataSource.getRepository(Tos);

    const tosData = [
      {
        code: 'TERMS_OF_SERVICE',
        title: '밋티 이용약관(요지)',
        template: `본 약관은 주식회사 **밋티**(이하 '회사')가 제공하는 중개 플랫폼 서비스의 이용 조건 및 절차, 회사와 회원의 권리·의무를 규정합니다.

- **서비스 성격**: 회사는 **통신판매중개자**로서 온라인 거래장소와 결제·정산 등 도구를 제공하며, 개별 거래의 당사자가 아닙니다.
- **가입/자격**: 만 **14세 이상**만 가입 가능. 실명/타인정보 도용 금지.
- **수수료**: 반반티켓 수수료 **판매자 5% / 구매자 5%**, 양도 수수료 **판매자 7%**(세부 기준은 수수료 안내 참조).
- **거래/확정**: 구매자가 미확정 시 **공연/경기 시작 + 24시간** 후 자동 확정.
- **취소/환불**:
    - 판매자 일방 취소 또는 발권·구매정보 **불일치** 확인 시 환불 가능(판매자에 **취소수수료 30%** 부과).
    - 공연/경기 **취소 시 자동 환불**(수수료 없음).
    - 구매자는 원칙적으로 **임의 취소 불가**(정책상 인정 사유 제외).
- **금지행위**: 직거래 유도, 위조/무료초대권 등 불법·부적합 상품 등록, 권리침해, 어뷰징 등.
- **면책**: 회사의 고의·중과실이 없는 한, 회원 간 거래 분쟁·상품하자 등에 대해 책임을 지지 않습니다.
- **약관 변경**: 일반 변경은 **7일 전**, 불리한 변경은 **30일 전** 공지. 계속 이용 시 동의로 간주(주요 변경은 재동의 받을 수 있음).

전문은 아래 링크에서 확인하세요.
→ **[밋티 이용약관(전문) 보기]**`,
        version: 1,
      },
      {
        code: 'PRIVACY_COLLECTION',
        title: '개인정보 수집·이용 동의',
        template: `**개인정보 수집·이용 동의(필수)**

- **목적**: 회원가입 및 본인확인, 서비스 제공(거래 중개·결제·정산·알림), 민원/분쟁 처리, 보안(부정이용 방지), **현금영수증 발급**
- **수집 항목**:
    - 가입정보: 이름, 휴대전화번호, 이메일(ID), 비밀번호, 생년월일(만 14세 이상 확인)
    - 본인확인 시: CI/DI(필요 시)
    - 거래정보: 주문번호, 상품/공연·경기명, 일시, 좌석/등급, 정산 계좌정보(판매자), 결제 승인/취소 내역(PG 연동)
    - 로그정보: 접속기록, IP, 기기정보(OS/모델)
- **보유기간**: 회원 탈퇴 또는 목적 달성 시 지체 없이 파기. 다만 전자상거래법 등 관계 법령에 따른 보존 기간은 그에 따름(계약·대금결제·분쟁처리 등).
- **거부권 및 불이익**: 동의를 거부할 권리가 있으나, 미동의 시 **회원가입 및 거래 이행이 제한**될 수 있습니다.`,
        version: 1,
      },
      {
        code: 'PRIVACY_THIRD_PARTY',
        title: '개인정보 제3자 제공 동의',
        template: `**개인정보 제3자 제공 동의(필수)**

- **제공받는 자**:
    
    ① 거래 상대방(판매자/구매자)
    
    ② 결제대행사(PG) **[예: ○○페이먼츠]**
    
    ③ 알림 발송 대행사(문자/알림톡/이메일) **[예: ○○알림, 카카오 알림톡 대행사]**
    
    ④ **현금영수증 발급** 관련 기관(국세청/대행 사업자 **[예: ○○네트웍스]**)
    
- **제공 목적**: 거래의 체결·이행(상품 전달/환불/분쟁 처리), 결제 승인·정산, 거래 관련 고지·알림, 현금영수증 발급
- **제공 항목**: 성명(또는 닉네임), 휴대전화번호, 이메일, 주문/거래 식별정보(주문번호, 공연/경기 정보, 좌석/등급 등), 결제 승인/정산에 필요한 정보, 판매자 정산 계좌정보(정산 관계)
- **보유·이용기간**: 목적 달성 시 또는 법정 보존기간 만료 시까지
- **거부권 및 불이익**: 동의를 거부할 권리가 있으나, **필수 제공 미동의 시 거래 이행이 불가**합니다.`,
        version: 1,
      },
      {
        code: 'ELECTRONIC_FINANCE',
        title: '전자금융거래 이용약관 동의',
        template: `**전자금융거래 이용약관 요지**

- 전자적 방법의 결제, 오류정정, 거래내역 통지, 사고신고, 책임한계, 예치/정산, 분쟁처리 절차를 규정합니다.
- 결제 승인·오류 발생 시 회사와 PG는 관련 법령 및 약관에 따라 처리합니다.
    
    전문은 링크에서 확인하세요. → **[전자금융거래 이용약관(전문) 보기]**`,
        version: 1,
      },
      {
        code: 'AGE_VERIFICATION',
        title: '만 14세 이상 확인',
        template: `본인은 만 14세 이상임을 확인합니다. (만 14세 미만은 가입할 수 없습니다.)`,
        version: 1,
      },
      {
        code: 'MARKETING_CONSENT',
        title: '마케팅 정보 수신 동의(선택)',
        template: `**마케팅 정보 수신 동의(선택)**

- **목적**: 이벤트/혜택/신규 서비스 안내, 맞춤형 혜택 제공
- **항목**: 연락처(이메일·휴대전화), 서비스 이용 기록(구매/관심 카테고리 등)
- **보유기간**: 철회 시 또는 목적 달성 시까지
- **거부권/불이익**: 미동의 시에도 서비스 이용에는 제한이 없습니다. 언제든 철회 가능.
    
    수신 채널 선택:
    
    [ ] 이메일  [ ] 문자/알림톡  [ ] 앱 푸시`,
        version: 1,
        groupId: 2,
      },
    ];

    for (const tosDataItem of tosData) {
      const existingTos = await tosRepository.findOne({
        where: { code: tosDataItem.code },
      });

      if (!existingTos) {
        const tos = tosRepository.create(tosDataItem);
        await tosRepository.save(tos);
        console.log(`약관 생성됨: ${tos.title} (${tos.code})`);
      } else {
        console.log(
          `약관이 이미 존재함: ${existingTos.title} (${existingTos.code})`,
        );
      }
    }
  }
}
